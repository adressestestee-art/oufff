<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Photo volontaire</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 20px">
  <h2>ğŸ“¸ Prendre une photo et lâ€™envoyer</h2>
  
  <!-- VidÃ©o camÃ©ra -->
  <video id="video" autoplay playsinline width="320" style="border:1px solid #ccc; border-radius:10px"></video>
  <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
  
  <br><br>
  
  <!-- Nom utilisateur -->
  <input type="text" id="username" placeholder="Votre nom" style="padding:8px; width:200px">
  <br><br>
  
  <!-- Bouton capture -->
  <button id="capture" style="padding:10px 20px; font-size:16px; border:none; background:#2c3e50; color:white; border-radius:6px; cursor:pointer;">
    ğŸ“¤ Capturer et envoyer
  </button>

  <script>
    // Initialiser EmailJS
    emailjs.init("mxm3fFA_BxEhqJieq");

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    const captureButton = document.getElementById('capture');
    const usernameInput = document.getElementById('username');

    // Demander lâ€™accÃ¨s Ã  la camÃ©ra
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        alert("âš ï¸ Erreur d'accÃ¨s camÃ©ra : " + err);
      });

    // Quand on clique sur le bouton
    captureButton.addEventListener('click', () => {
      // VÃ©rifier que le nom est renseignÃ©
      const userName = usernameInput.value.trim();
      if (!userName) {
        alert("Merci dâ€™entrer votre nom avant dâ€™envoyer !");
        return;
      }

      // Dessiner image dans le canvas
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = canvas.toDataURL("image/png");

      // Envoyer avec EmailJS
      emailjs.send("service_8cs0gml", "template_w14xn7c", {
        name: userName,
        time: new Date().toLocaleString(),
        message: "Nouvelle photo volontaire ğŸ“¸",
        image: imageData
      })
      .then(() => {
        alert("âœ… Photo envoyÃ©e avec succÃ¨s !");
      })
      .catch(err => {
        alert("âŒ Erreur lors de l'envoi : " + JSON.stringify(err));
      });
    });
  </script>
</body>
</html>
